<% layout("/layouts/boilerplate.ejs") %>

<style>
  /* ---------- Listing Card ---------- */
  .listing-card {
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    background: #fff;
    transition: transform 0.3s ease;
  }

  .listing-card:hover {
    transform: translateY(-5px);
  }

  .listing-card img {
    height: 300px;
    object-fit: cover;
    width: 100%;
  }

  .listing-details {
    padding: 20px;
    background: #fafafa;
  }

  .listing-details h3 {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 15px;
  }

  .listing-details p {
    margin-bottom: 8px;
    font-size: 16px;
  }

  .price-pill {
    background: #343a40;
    color: #fff;
    padding: 6px 14px;
    border-radius: 20px;
    display: inline-block;
    font-size: 18px;
    margin-top: 10px;
  }

  /* ---------- Booking Form ---------- */
  .booking-card {
    border: 1px solid #ddd;
    border-radius: 15px;
    padding: 20px;
    background: #fdfdfd;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    margin-top: 30px;
  }

  .booking-card input:focus {
    border-color: #343a40;
    box-shadow: 0 0 5px rgba(52,58,64,0.4);
  }

  /* ---------- Login Alert ---------- */
  .login-alert {
    border: 1px solid #ddd;
    background: #fff8e1;
    padding: 15px;
    border-radius: 10px;
    color: #8a6d3b;
    margin-top: 30px;
  }

  /* ---------- Reviews ---------- */
  .review-card {
    border-left: 4px solid #343a40;
    padding: 15px;
    border-radius: 10px;
    background: #fdfdfd;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    margin-bottom: 20px;
  }

  .review-card .starability-result {
    font-size: 20px;
    color: #f1c40f;
  }

  /* ---------- Review Form ---------- */
  textarea {
    resize: none;
    font-size: 16px;
    padding: 10px;
    width: 100%;
    border-radius: 5px;
    border: 1px solid #ccc;
  }

  textarea:focus {
    outline: none;
    border-color: #6c757d;
  }

  .invalid-feedback {
    color: #e74c3c;
    font-size: 14px;
  }

  /* ---------- Buttons ---------- */
  .btn-outline-dark, .btn-dark {
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .btn-outline-dark:hover, .btn-dark:hover {
    background-color: #343a40;
    color: #fff;
  }
  .btn-pill {
  border-radius: 50px;
  padding: 10px 25px;
  font-size: 16px;
  transition: all 0.3s ease;
}

.btn-pill:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

</style>

<div class="container">
  <!-- Listing Card -->
  <div class="row mt-4">
    <div class="col-10 offset-1">
      <div class="listing-card">
        <img src="<%= listing1.image.url %>" alt="Listing Image" />
        <div class="listing-details">
          <h3><%= listing1.title %></h3>
          <p>üë§ Owned by <%= listing1.owner.username %></p>
          <p>üìç <%= listing1.location %>, <%= listing1.country %></p>
          <p>üè∑Ô∏è <%= listing1.category %></p>
          <div class="price-pill">&#8377; <%= listing1.price.toLocaleString("en-IN") %> / night</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Buttons for Owner -->
  <% if (currUser && listing1.owner._id.equals(currUser._id)) { %>
    <div class="row mt-4">
  <div class="col-6 offset-3 d-flex justify-content-center gap-3">
    <a href="/listings/<%= listing1._id %>/edit" class="btn btn-outline-dark btn-pill shadow-sm">
      ‚úèÔ∏è Edit
    </a>
    <form method="post" action="/listings/<%= listing1._id %>?_method=DELETE">
      <button class="btn btn-dark btn-pill shadow-sm">üóë Delete</button>
    </form>
  </div>
</div>

  <% } %>

  <!-- Please Login Message -->
  <% if (!currUser) { %>
    <div class="col-8 offset-2 login-alert">
      üîí Please <a href="/login">log in</a> to book this listing.
    </div>
  <% } %>

  <!-- Booking Form -->
  <% if (currUser && !listing1.owner._id.equals(currUser._id)) { %>
    <div class="col-8 offset-2 booking-card">
      <h4 class="mb-3">Book This Room</h4>
      <form method="post" action="/listings/<%= listing1._id %>/book">
        <div class="mb-3">
          <label for="checkIn" class="form-label">Check-In</label>
          <input type="date" name="checkIn" id="checkIn" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="checkOut" class="form-label">Check-Out</label>
          <input type="date" name="checkOut" id="checkOut" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-outline-dark w-100">Book Now</button>
      </form>
    </div>
  <% } %>

  <!-- Review Form -->
  <div class="row mt-5">
    <div class="col-8 offset-2">
      <hr />
      <% if (currUser) { %>
        <h4>Leave a Review</h4>
        <form action="/listings/<%= listing1.id %>/reviews" method="post" novalidate class="needs-validation">
          <div class="mb-3">
            <label for="rating" class="form-label">Rating</label>
            <fieldset class="starability-slot">
              <% for (let i = 1; i <= 5; i++) { %>
                <input type="radio" id="rate<%= i %>" name="review[rating]" value="<%= i %>"/>
                <label for="rate<%= i %>" title="<%= ['Terrible', 'Not good', 'Average', 'Very good', 'Amazing'][i-1] %>">
                  <%= i %> star<%= i > 1 ? 's' : '' %>
                </label>
              <% } %>
            </fieldset>
          </div>
          <div class="mb-3">
            <label for="comment" class="form-label">Comment</label>
            <textarea name="review[comment]" id="comment" rows="5" required></textarea>
            <div class="invalid-feedback">Please add some comments for review</div>
          </div>
          <button class="btn btn-outline-dark">Submit</button>
        </form>
      <% } %>
    </div>
  </div>

  <!-- Reviews Section -->
  <div class="row mt-4">
    <div class="col-8 offset-2">
      <h4>All Reviews</h4>
      <% for (review of listing1.reviews) { %>
        <div class="review-card">
          <h5>@<%= review.author.username %></h5>
          <p class="starability-result" data-rating="<%= review.rating %>"></p>
          <p><%= review.comment %></p>
          <form action="/listings/<%= listing1._id %>/reviews/<%= review._id%>?_method=DELETE" method="post">
            <button class="btn btn-sm btn-dark mt-2">Delete</button>
          </form>
        </div>
      <% } %>
    </div>
  </div>
</div>
